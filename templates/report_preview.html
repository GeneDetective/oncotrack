<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>AI Report Preview</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 960px; margin: 24px auto; line-height: 1.5; color:#111827; }
    h1 { margin: 0 0 16px 0; font-size: 24px; }
    h2 { margin: 24px 0 10px 0; font-size: 18px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; vertical-align: top; }
    th { background: #f3f4f6; }
    .card { background:#fff; border:1px solid #e5e7eb; padding:14px; border-radius:8px; margin-bottom:16px; }
    .mut { background:#fff7ed; padding:6px 10px; border-radius:6px; display:inline-block; margin:4px 6px 0 0; font-family: monospace; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; white-space: pre-wrap; word-break: break-word; background:#f8fafc; padding:12px; border-radius:6px; border:1px solid #e5e7eb; }
    .exec { background:#f8fafc; padding:16px; border-radius:6px; white-space: pre-wrap; line-height:1.6; border:1px solid #e5e7eb; }
    .row { display:flex; gap: 16px; align-items: center; }
    .back { padding: 10px 14px; background:#374151;color:white;border:none;border-radius:6px; cursor:pointer; text-decoration:none; display:inline-block; }
    .footer { color:#6b7280; font-size: 12px; margin-top: 12px; }
  </style>
</head>
<body>
  <h1>Patient Molecular Report — AI Executive Summary (Preview)</h1>

  <!-- Meta summary chips (quick glance) -->
  <div class="card">
    <div class="row" style="flex-wrap: wrap;">
      <div><strong>Gene:</strong> {{ analysis.gene or 'N/A' }}</div>
      <div><strong>Exon:</strong> {{ analysis.exon or 'N/A' }}</div>
      <div><strong>Patient age:</strong> {{ patient_info.age or 'Not specified' }}</div>
      <div><strong>Sex:</strong> {{ patient_info.sex or 'Not specified' }}</div>
      <div><strong>Cancer type:</strong> {{ patient_info.cancer_type or 'Not specified' }}</div>
    </div>
    <div style="margin-top:8px;">
      <strong>Variants:</strong>
      {% if analysis.variants_hgvs and analysis.variants_hgvs|length>0 %}
        {% for v in analysis.variants_hgvs %}
          <span class="mut">{{ v }}</span>
        {% endfor %}
      {% else %}
        <span class="mut">None</span>
      {% endif %}
    </div>
  </div>

  <!-- Patient Info (table mirrors ai_report.py PDF structure) -->
  <h2>Patient Info</h2>
  <table>
    <tr><th>Field</th><th>Value</th></tr>
    <tr><td>Age</td><td>{{ patient_info.age or "Not specified" }}</td></tr>
    <tr><td>Sex</td><td>{{ patient_info.sex or "Not specified" }}</td></tr>
    <tr><td>Cancer type</td><td>{{ patient_info.cancer_type or "Not specified" }}</td></tr>
    <tr><td>Doctor notes</td><td>{{ doctor_notes or "Not specified" }}</td></tr>
  </table>

  <!-- Molecular Profiling (same columns as in ai_report.py PDF) -->
  <h2>Molecular Profiling</h2>
  <table>
    <tr>
      <th>Gene</th>
      <th>RefSeq mRNA</th>
      <th>Exon</th>
      <th>Variants</th>
    </tr>
    <tr>
      <td>{{ analysis.gene or "N/A" }}</td>
      <td>{{ analysis.ref_accession or "N/A" }}</td>
      <td>{{ analysis.exon or "N/A" }}</td>
      <td>
        {% if analysis.variants_hgvs and analysis.variants_hgvs|length>0 %}
          {% for v in analysis.variants_hgvs %}
            <span class="mut">{{ v }}</span>
          {% endfor %}
        {% else %}
          None
        {% endif %}
      </td>
    </tr>
  </table>

  <!-- Alignment (reference vs patient) -->
  {% if analysis.aligned_ref or analysis.aligned_obs %}
    <h2>Alignment (reference vs patient)</h2>
    {% if analysis.aligned_ref %}
      <div class="mono">{{ analysis.aligned_ref }}</div>
    {% endif %}
    {% if analysis.aligned_obs %}
      <div class="mono">{{ analysis.aligned_obs }}</div>
    {% endif %}
  {% endif %}

  <!-- Executive Summary -->
  <h2>Executive Summary</h2>
  <div class="exec">{{ report_text }}</div>

  <div style="margin-top:16px;">
    <a class="back" href="/">Back</a>
  </div>

  <div class="footer">
    Report generated by Mutation Tool — AI Executive Summary.
  </div>
</body>
</html>
